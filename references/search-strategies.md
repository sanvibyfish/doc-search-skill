# 搜索策略详解

## 权重系统

搜索采用加权评分机制，同一文件的多种匹配会累加分数：

```
最终分数 = Σ (匹配类型权重 × 匹配次数衰减)
```

### 权重定义

| 匹配类型 | 权重 | 说明 |
|---------|------|------|
| filename_exact | 100 | 文件名（不含扩展名）完全匹配 |
| filename_contains | 80 | 文件名包含关键词 |
| title | 70 | Markdown H1 标题匹配 |
| frontmatter | 60 | YAML frontmatter 字段匹配 |
| heading | 50 | H2-H6 标题匹配 |
| content | 40 | 正文内容匹配（前3次有效） |

### 分数示例

```
文件 A: 文件名包含(80) + 标题匹配(70) + 内容匹配×2(80) = 230
文件 B: 内容匹配×5(120，最多算3次) = 120
文件 C: 文件名完全匹配(100) = 100

排序: A > B > C
```

## 分词策略

### 英文
- 按空格和标点分割
- 转换为小写
- 保留数字和下划线

### 中文
- 按单字切分（简单策略）
- 不做停用词过滤

### 混合文本
- 分别处理后合并
- 例: "API接口" → ["api", "接", "口"]

## 搜索模式

### 1. 直接搜索（无索引）

适用场景：
- 小型项目（<1000文件）
- 一次性搜索
- 实时性要求高

```bash
python scripts/search.py "关键词" /path/to/docs
```

### 2. 索引搜索

适用场景：
- 大型项目（>1000文件）
- 频繁搜索
- 需要快速响应

```bash
# 构建索引
python scripts/indexer.py /path/to/docs -o index.json

# 搜索
python scripts/search.py "关键词" -i index.json
```

### 3. ripgrep 快速搜索

适用场景：
- 已知关键词精确
- 不需要评分排序
- CLI 环境

```bash
rg "精确关键词" --type md -C 2
```

## 高级技巧

### 搜索标题

```bash
rg "^#.*关键词" --type md
```

### 搜索 frontmatter

```bash
rg -U "^---[\s\S]*?关键词[\s\S]*?^---" --type md
```

### 搜索代码注释

```bash
rg "//.*关键词|#.*关键词" --type py --type js
```

### 组合条件

```bash
rg "关键词A" | xargs rg "关键词B"
```

## 性能优化

1. **使用索引** - 对大型项目减少 IO
2. **限制文件类型** - 排除不需要的格式
3. **设置排除目录** - 跳过 node_modules 等
4. **限制结果数量** - 使用 --limit 参数
5. **增量更新** - 只重建变化的文件索引
